:80 {
  encode gzip

  # Serve the static viewer from the MCP container or this repo directly later
  @static path_regexp static ^/($|index\.html|setup|config|config/json|config/stdio)$
  handle @static {
    reverse_proxy mcp:3000
  }

  # MCP SSE at root and WebSocket
  @mcp path_regexp mcp ^/$
  handle @mcp {
    reverse_proxy mcp:3000
  }
  handle_path /ws/* {
    reverse_proxy mcp:3000
  }

  # Guacamole web app (Tomcat)
  handle_path /guac/* {
    reverse_proxy guacamole:8080
  }

  # Default: 404
  respond 404
}
